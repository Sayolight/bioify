generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DB_URL")
}

model User {
  id               BigInt            @id @default(autoincrement())
  firstName        String
  lastName         String?
  username         String?
  phoneNumber      String?
  language         String?
  createdAt        DateTime          @default(now())
  analyticLinks    AnalyticLink[]    @relation("AnalyticLinkVisitor")
  analyticProfiles AnalyticProfile[] @relation("AnalyticProfileVisitor")
  profiles         Profile[]
}

model Profile {
  id               Int               @id @default(autoincrement())
  ownerId          BigInt
  title            String
  analyticLinks    AnalyticLink[]
  analyticProfiles AnalyticProfile[]
  items            Item[]
  owner            User              @relation(fields: [ownerId], references: [id])
}

model Item {
  id        Int     @id @default(autoincrement())
  profileId Int
  headerId  Int?
  linkId    Int?
  textId    Int?
  position  Int
  header    Header? @relation(fields: [headerId], references: [id], onDelete: Cascade)
  link      Link?   @relation(fields: [linkId], references: [id], onDelete: Cascade)
  profile   Profile @relation(fields: [profileId], references: [id])
  text      Text?   @relation(fields: [textId], references: [id], onDelete: Cascade)
}

model Link {
  id            Int            @id @default(autoincrement())
  label         String
  value         String
  analyticLinks AnalyticLink[]
  items         Item[]
}

model Text {
  id    Int    @id @default(autoincrement())
  value String
  items Item[]
}

model Header {
  id    Int    @id @default(autoincrement())
  value String
  items Item[]
}

model AnalyticLink {
  id        Int      @id @default(autoincrement())
  profileId Int
  linkId    Int
  visitorId BigInt
  createdAt DateTime @default(now())
  link      Link     @relation(fields: [linkId], references: [id])
  profile   Profile  @relation(fields: [profileId], references: [id])
  visitor   User     @relation("AnalyticLinkVisitor", fields: [visitorId], references: [id])
}

model AnalyticProfile {
  id        Int      @id @default(autoincrement())
  profileId Int
  visitorId BigInt
  createdAt DateTime @default(now())
  profile   Profile  @relation(fields: [profileId], references: [id])
  visitor   User     @relation("AnalyticProfileVisitor", fields: [visitorId], references: [id])
}
